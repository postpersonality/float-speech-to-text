# float-speech-to-text
Минималистичный интерфейс голосового ввода с автовставкой надиктованного текста.

## Цель приложения

Это приложение представляет собой компактный плавающий виджет для Linux (с поддержкой Wayland и X11), предназначенный для быстрого голосового ввода текста.

Основная цель — позволить пользователю диктовать текст и автоматически вставлять его в любое активное приложение (мессенджер, редактор кода, браузер) без необходимости переключаться между окнами или использовать облачные сервисы. Все распознавание происходит локально на устройстве, обеспечивая приватность и скорость работы.

## Основные функции

*   **Плавающий интерфейс:** Компактное окно, которое всегда находится поверх других окон (использует GTK Layer Shell в Wayland).
*   **Локальное распознавание:** Использует ONNX-модель (`gigaam-v3-e2e-rnnt`) для преобразования речи в текст без отправки данных в интернет.
*   **Управление записью:**
    *   Старт/Стоп записи одной кнопкой.
    *   Возможность перезаписать фразу, если ошиблись.
*   **Интеграция с буфером обмена:**
    *   Поддержка стандартного буфера обмена (`Ctrl+V`).
    *   Поддержка Primary Selection (выделение мышью / средняя кнопка).
*   **Автоматическая вставка:** Эмуляция нажатия клавиш (через `wtype`) для мгновенной вставки распознанного текста в активное поле ввода.
*   **Сохранение состояния:** Запоминает позицию окна на экране.

## Установка и Зависимости

Для работы приложения необходимы системные библиотеки и пакеты Python.

### Системные зависимости (Linux)

Пример установки для Arch Linux / Manjaro:

```bash
# GTK3 и поддержка Layer Shell (для Wayland)
sudo pacman -S gtk3 gtk-layer-shell

# Инструменты для работы с буфером обмена
# Для Wayland:
sudo pacman -S wl-clipboard wtype
# Для X11:
sudo pacman -S xsel xclip
```

Пример установки для Debian / Ubuntu:

```bash
# GTK3 и поддержка Layer Shell
sudo apt install gir1.2-gtk-3.0 gir1.2-gtk-layer-shell-0.1 python3-gi python3-gi-cairo

# Инструменты для работы с буфером обмена
# Для Wayland:
sudo apt install wl-clipboard wtype
# Для X11:
sudo apt install xsel xclip
```

Пример установки для Fedora:

```bash
# GTK3 и поддержка Layer Shell
sudo dnf install gtk3 gtk-layer-shell python3-gobject

# Инструменты для работы с буфером обмена
# Для Wayland:
sudo dnf install wl-clipboard wtype
# Для X11:
sudo dnf install xsel xclip
```

*   **wl-clipboard**: Для работы с буфером обмена в Wayland.
*   **wtype**: Для эмуляции нажатия клавиш (авто-вставка) в Wayland.
*   **gtk-layer-shell**: Библиотека для создания плавающих окон в Wayland.

### Python зависимости

Установите необходимые библиотеки через pip:

```bash
pip install numpy sounddevice pyclip PyGObject
```

*   **numpy**: Для работы с аудио-данными.
*   **sounddevice**: Для записи звука с микрофона (требует PortAudio).
*   **pyclip**: Кроссплатформенная работа с буфером обмена.
*   **PyGObject**: Привязки для GTK.
*   **onnx_asr**: Библиотека для инференса модели распознавания речи (убедитесь, что она доступна в вашем окружении).

### Модель распознавания

Приложение настроено на использование модели `gigaam-v3-e2e-rnnt`. При первом запуске библиотека `onnx_asr` может попытаться загрузить необходимые файлы модели, если это предусмотрено её реализацией, либо вам потребуется скачать модель вручную и разместить её согласно документации `onnx_asr`.

## Запуск

```bash
python3 fstt.py
```

## Использование

1.  **Запись:** Нажмите кнопку с кружком (●), чтобы начать говорить.
2.  **Стоп и Распознавание:** Нажмите кнопку стоп (■). Приложение обработает запись и скопирует текст.
3.  **Авто-вставка:** Если включена галочка (☑), текст сразу появится в активном поле ввода.
4.  **Перезапись:** Если вы оговорились, нажмите кнопку перезагрузки (↻) во время записи, чтобы сбросить текущий фрагмент и начать заново.
5.  **Перемещение:** Окно можно перетаскивать мышью за любую область.

